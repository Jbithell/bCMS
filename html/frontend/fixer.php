<?php
require_once __DIR__ . '/common/head.php';

/*
$data = ["820"=>"Chris Lowther","822"=>"Nik Engineer","823"=>"Ben Masters","824"=>"Rob Cantarero","825"=>"Andy Exley","826"=>"Ed Humphreys","845"=>"Camille Augarde","847"=>"Tom King","848"=>"Steph Crewes","849"=>"Rob Perkins","850"=>"Kirran Shah","851"=>"Heloise Wood","852"=>"Holly Williams","853"=>"Holly Williams","854"=>"Flora Bradwell","855"=>"Marisa  Tuffnell","856"=>"Laura Herbert","857"=>"N. Luke Abraham","860"=>"Toby Green","861"=>"Johan Carlin","872"=>"Nick Dingwall","875"=>"Ben Toone","876"=>"Jo Shelley","877"=>"Heidi Blake","878"=>"Ellen Carpenter","879"=>"Robin Seaton","880"=>"Toby Green","882"=>"Daniel Whitehead","883"=>"Toby Green","884"=>"Heidi Blake","885"=>"Heidi Blake","886"=>"Charlotta Salmi","887"=>"Toby Green","888"=>"Heidi Blake","889"=>"Daniel Whitehead","891"=>"Chloe Schroeter","892"=>"Simon Lickley","893"=>"Ed Humphreys","894"=>"Ben Masters","895"=>"Robert Cantarero","896"=>"Steven Morrison","898"=>"Jamie Merrill","904"=>"Adam Sloan","905"=>"Claire Yeo","1217"=>"Antonia Moura","1186"=>"Lucy Peden","1186"=>"Robin","1186"=>"Laura Street","1184"=>"Kathryn Bromwich","1184"=>"Shan Vahidy","1148"=>"Claire Yeo","1273"=>"Hannah Burnham","1273"=>"Missy Christey","1273"=>"Rebecca Jones","1273"=>"Laura Nichol","1278"=>"Ben Rackstraw","1282"=>"Helen Citron","1282"=>"Molly Bird","1287"=>"Luke Boulter","1299"=>"Tim Human","1308"=>"Milda Sabunaite","1310"=>"Heidi Blake","1003"=>"Lucy Peden","629"=>"Jamie Merrill","333"=>"Rachel Ringstead","262"=>"Lauren Carter","125"=>"Tom King","13"=>"Rachel Ringstead","156"=>"Toby Green","1034"=>"Jamie Merrill","1129"=>"Ben Toone","805"=>"Lauren Carter","716"=>"Kate Smith","1029"=>"Kate Smith","810"=>"Helen Tilley","935"=>"Holly Williams","530"=>"Simon Davies","174"=>"Jessica Levy","815"=>"Ellen Carpenter","874"=>"Adam Sloan","128"=>"Lucy Peden","128"=>"Chris Spillane","127"=>"Nan Flory","117"=>"Vicky Hallam","96"=>"Ben Masters","1401"=>"Sam Whittaker","1410"=>"Sara Sayeed","1418"=>"Amy Milka","1419"=>"Amy Milka","1420"=>"Amy Milka","1428"=>"Ellen Carpenter","1462"=>"Raf Sanchez","33"=>"Toby Green","858"=>"Lucy Peden","773"=>"Lucy Peden","685"=>"Lucy Peden","1586"=>"Lucy Peden","1595"=>"Sara Sayeed","1595"=>"Steve Gardner","1595"=>"Oliver Elliot","795"=>"Ben Toone","328"=>"Becky Mitchell","44"=>"Lucy Peden","45"=>"Alex Stevens","1712"=>"Ben Rackstraw","1712"=>"Sara Sayeed","1712"=>"Oliver Elliott","1712"=>"Kathryn Bromwich","938"=>"Sam Noble","522"=>"Vicky Hallam","1130"=>"Sophy Welch","859"=>"Lucy Peden","233"=>"Rachel Ringstead","468"=>"Becky Mitchell","518"=>"Flora Bradwell","703"=>"Kirran Shah","504"=>"Amy Blackmore","1015"=>"Kirran Shah","398"=>"Toby Green","1899"=>"Toby Green","1840"=>"David Coates","2027"=>"Anjli Raval","2058"=>"Sarah Foster","2059"=>"Nicky Woolf","2061"=>"Nicky Woolf","2062"=>"Nicky Woolf","2068"=>"Nicky Woolf","2278"=>"Nicky Woolf","2327"=>"Sarah Foster","2396"=>"Katy Dennis-Smithen","2403"=>"Henry James Foy","2409"=>"Raf Sanchez","2408"=>"Raf Sanchez","2419"=>"Francis Boorman","2442"=>"Charlie Kirkbride","2487"=>"Henry James Foy","2456"=>"Liam O'Brian","2456"=>"Liam O'Brian","2576"=>"Lida Mirzaii","2578"=>"Elly Vanesse","2589"=>"Jenny O'Mahony","2638"=>"Amy Browne","2638"=>"Duncan Piper","2640"=>"=<Will Heaven>","2654"=>"Alex Russell","2664"=>"Charlotte Kirkbride","2668"=>"Li Peng Cheok","2677"=>"Matt Crawford","2683"=>"Stephen Mitchell","3258"=>"Esme Anderson","3294"=>"Sarah Foster","3311"=>"Dan Hyde","3317"=>"Antonia Shaw","3340"=>"Christiana Hambro","3377"=>"Nick Staines","3603"=>"Nicky Woolf","3630"=>"Polly Ingham","4110"=>"Sian Turner","4112"=>"Zoe Stones","4128"=>"Beth Gandy","4151"=>"Polly Ingham","4180"=>"Jed Fazarkaley","4181"=>"Jed Fazarkaley","4182"=>"Jed Fazakarley","4263"=>"Henry James Foy","4388"=>"Antonia Shaw","4603"=>"Henry James Foy","4625"=>"Sian Turner","4694"=>"Edward Fisher","4785"=>"Henry James Foy","4926"=>"Maks Fus Mickiewicz","4942"=>"Adrian Choa","4965"=>"Anjli Raval","4964"=>"Holly Hyde","4964"=>"Adrian Choa","5193"=>"Laura Connor","5588"=>"Jennifer Carlson","5798"=>"Henry James Foy","5903"=>"Emma Rudeck","6154"=>"Leigh Clarke","6876"=>"Hannah Smith","6913"=>"Peter Campbell","6902"=>"Neil Lazarus","6980"=>"Sam Newsome","7287"=>"Holly Hyde","7433"=>"Susannah Shrubsole","7636"=>"Adam Clark","7693"=>"Jim Bulley","815"=>"125","858"=>"52","874"=>"23","1217"=>"16","1186"=>"52","1186"=>"6","1186"=>"53","1184"=>"57","1184"=>"50","1148"=>"83","1273"=>"88","1273"=>"87","1273"=>"74","1273"=>"75","1278"=>"66","1282"=>"76","1287"=>"35","1299"=>"93","1308"=>"11","1310"=>"7","1003"=>"52","629"=>"54","333"=>"112","262"=>"94","125"=>"119","13"=>"112","156"=>"8","1034"=>"54","1129"=>"107","810"=>"135","805"=>"94","1029"=>"130","935"=>"40","530"=>"109","174"=>"116","128"=>"52","128"=>"101","127"=>"38","117"=>"51","96"=>"27","504"=>"143","1401"=>"186","1410"=>"36","1418"=>"41","1419"=>"41","1420"=>"41","1428"=>"125","1462"=>"31","33"=>"8","773"=>"52","685"=>"52","1586"=>"52","1595"=>"36","1595"=>"49","795"=>"107","328"=>"104","44"=>"52","45"=>"12","1712"=>"66","1712"=>"36","1712"=>"70","1712"=>"57","938"=>"187","703"=>"108","522"=>"51","1130"=>"224","859"=>"52","233"=>"112","468"=>"104","518"=>"113","1015"=>"108","398"=>"8","1899"=>"8","1840"=>"68","2027"=>"65","2058"=>"216","2059"=>"17","2061"=>"17","2062"=>"17","2068"=>"17","2278"=>"17","2327"=>"216","2396"=>"261","2403"=>"274","2409"=>"31","2408"=>"31","2419"=>"84","4785"=>"274","2487"=>"274","2576"=>"280","2638"=>"334","2654"=>"295","2668"=>"337","2677"=>"307","2683"=>"200","3603"=>"17","3630"=>"283","3258"=>"336","3294"=>"216","3311"=>"275","3317"=>"359","3377"=>"317","5903"=>"412","4110"=>"279","4128"=>"282","4151"=>"283","4263"=>"274","4388"=>"359","4603"=>"274","4625"=>"279","4694"=>"446","4926"=>"381","4942"=>"384","4965"=>"65","4964"=>"383","4964"=>"384","5193"=>"382","5588"=>"329","5798"=>"274","6154"=>"333","6876"=>"352","6913"=>"268","6902"=>"450","8205"=>"382","8734"=>"279","8734"=>"387","8573"=>"17","9253"=>"383","9255"=>"383","9467"=>"Adam Shergold","9475"=>"432","9475"=>"352","9467"=>"286","9587"=>"279","9587"=>"387","9587"=>"389","9793"=>"482","7287"=>"383","9875"=>"489","12112"=>"419","12588"=>"405","12612"=>"493","12643"=>"279","12643"=>"275","12643"=>"31","12643"=>"208","12643"=>"286","12959"=>"359","12961"=>"333","12986"=>"495","13081"=>"275","13091"=>"417","13091"=>"447","13390"=>"434","13611"=>"507","13710"=>"286","13838"=>"333","13856"=>"419","14135"=>"372","14300"=>"103","14320"=>"534","14327"=>"539","14327"=>"540","14327"=>"541","14328"=>"539","14328"=>"540","14328"=>"541","14329"=>"539","14329"=>"540","14329"=>"541","14352"=>"539","14352"=>"540","14352"=>"541","14353"=>"539","14353"=>"540","14353"=>"541","14354"=>"539","14354"=>"540","14354"=>"541","14373"=>"557","14384"=>"544","14384"=>"561","14428"=>"571","14434"=>"520","14479"=>"580","14479"=>"538","14479"=>"541","14480"=>"580","14480"=>"538","14480"=>"541","14481"=>"580","14481"=>"538","14481"=>"541","14482"=>"580","14482"=>"538","14482"=>"541","14483"=>"580","14483"=>"538","14483"=>"541","14484"=>"580","14484"=>"538","14484"=>"541","14571"=>"601","14630"=>"622","14637"=>"548","14684"=>"113","14684"=>"633","14684"=>"634","14689"=>"638","14689"=>"639","14689"=>"640","14689"=>"641","14689"=>"642","14689"=>"643","14689"=>"644","14689"=>"645","14707"=>"524","14712"=>"652","14723"=>"612","14723"=>"655","14723"=>"5","14797"=>"621","14798"=>"614","14814"=>"621","14814"=>"669","14821"=>"612","14833"=>"609","14847"=>"677","14869"=>"115","14951"=>"692","14978"=>"115","14995"=>"228","14997"=>"538","15021"=>"121","15021"=>"165","15021"=>"622","15023"=>"228","15024"=>"228","15025"=>"228","15026"=>"541","15206"=>"389","15209"=>"275","15368"=>"430","15645"=>"388","15231"=>"388","15231"=>"333","15843"=>"387","16173"=>"513","16349"=>"268","16373"=>"430","17083"=>"731","17047"=>"245","17241"=>"745","17393"=>"312","12710"=>"333","17517"=>"727","17559"=>"513","9567"=>"387","17753"=>"513","17296"=>"513","18012"=>"513","18100"=>"513","18120"=>"513","18143"=>"513","18147"=>"513","18148"=>"513","18181"=>"274","18181"=>"389","18181"=>"513","18354"=>"333","16515"=>"382","18669"=>"776","18329"=>"766","18951"=>"724","19083"=>"724","19151"=>"735","19053"=>"388","19351"=>"477","19046"=>"745","19046"=>"789","19046"=>"740","19046"=>"796","716"=>"130","20454"=>"745","20436"=>"728","21170"=>"333","21170"=>"729","21826"=>"745","22088"=>"434","22176"=>"724","22147"=>"746","22224"=>"738","22262"=>"5","22604"=>"737","22635"=>"425","23115"=>"745","23371"=>"728","23302"=>"286","23302"=>"729","23302"=>"724","23302"=>"494","21837"=>"745","21837"=>"746","21712"=>"745","21712"=>"389","23466"=>"430","23466"=>"513","23653"=>"832","23831"=>"832","23842"=>"333","23842"=>"274","23842"=>"724","23929"=>"333","23929"=>"274","23929"=>"494","23929"=>"513","24014"=>"729","24014"=>"286","24014"=>"333","24302"=>"738","24331"=>"724","24338"=>"775","24713"=>"766","24713"=>"779","24782"=>"477","24068"=>"752","24789"=>"758","24827"=>"812","25100"=>"Faye Tyreman","25053"=>"729","25288"=>"724","25518"=>"477","25121"=>"758","25526"=>"729","22312"=>"382","22312"=>"434","25743"=>"758","25711"=>"758","25753"=>"724","25811"=>"333","25911"=>"286","25911"=>"729","25911"=>"724","25911"=>"494","26056"=>"849","26147"=>"758","26336"=>"738","26501"=>"737","26728"=>"477","27328"=>"333","27328"=>"729","27328"=>"724","27328"=>"494","26251"=>"738","27771"=>"724","27771"=>"843","27908"=>"382","28557"=>"845","25894"=>"845","24748"=>"845","24748"=>"513","22298"=>"5","22298"=>"845","21888"=>"845","20192"=>"382","20192"=>"803","20192"=>"783","20192"=>"845","20149"=>"845","19477"=>"845","18483"=>"845","15648"=>"333","15648"=>"845","17888"=>"477","17888"=>"845","15572"=>"845","14174"=>"845","13904"=>"457","13904"=>"845","13693"=>"845","13676"=>"457","13676"=>"845","13454"=>"845","13370"=>"845","13364"=>"457","13364"=>"845","17143"=>"477","17143"=>"845","9894"=>"845","9833"=>"389","9833"=>"281","9833"=>"845","9527"=>"845","9064"=>"845","9232"=>"434","9232"=>"845","8907"=>"477","8907"=>"845","8903"=>"845","8210"=>"457","8210"=>"845","8136"=>"845","7737"=>"845","7693"=>"387","7693"=>"845","7177"=>"845","7109"=>"845","7081"=>"845","6539"=>"866","6448"=>"845","6311"=>"845","5826"=>"845","29248"=>"728","29329"=>"871","29791"=>"893","29736"=>"719","30008"=>"895","30008"=>"905","30027"=>"746","30632"=>"904","30702"=>"927","30734"=>"724","30776"=>"425","30829"=>"769","30946"=>"930","31436"=>"936","31436"=>"872","31436"=>"912","31485"=>"895","31539"=>"904","31783"=>"899","31590"=>"744","32997"=>"871","33111"=>"886","33101"=>"947","34231"=>"957","34074"=>"729","34517"=>"769","35173"=>"389","35131"=>"969","35131"=>"936","35131"=>"968","35383"=>"830","35421"=>"893","35415"=>"893","35589"=>"878","35283"=>"724","35496"=>"724","35426"=>"950","35859"=>"904","35871"=>"738","35871"=>"389","35884"=>"869","36200"=>"974","36204"=>"976","35545"=>"881","36451"=>"901","36567"=>"899","36676"=>"760","36695"=>"870","36695"=>"969","36695"=>"936","13057"=>"502","36988"=>"760","37079"=>"760","38713"=>"909","38847"=>"992","38910"=>"950","38910"=>"869","39074"=>"884","39066"=>"886","39045"=>"724","39191"=>"878","39350"=>"893","39350"=>"746","39527"=>"375","38235"=>"936","38235"=>"969","38235"=>"999","38235"=>"1000","39344"=>"913","38972"=>"724","38986"=>"724","38780"=>"724","39543"=>"729","39602"=>"Sebastian Scarbrough","39602"=>"Sebastian Scarbrough","39727"=>"760","40285"=>"877","40521"=>"746","40521"=>"736","40521"=>"906","40521"=>"1008","40521"=>"904","40531"=>"915","40531"=>"1010","40531"=>"943","40531"=>"737","40560"=>"736","40560"=>"952","40560"=>"943","40560"=>"1008","40560"=>"869","40560"=>"904","40588"=>"869","40588"=>"1014","40588"=>"952","40588"=>"1013","40588"=>"854","41288"=>"729","40814"=>"843","41462"=>"737","40548"=>"995","40548"=>"1012","40548"=>"915","40548"=>"996","40548"=>"894","40548"=>"1013","40548"=>"1017","41639"=>"914","41666"=>"736","41925"=>"724","42472"=>"1021","42472"=>"1023","42472"=>"1024","42472"=>"737","42472"=>"1022","42581"=>"1025","42575"=>"1025","42594"=>"1025","49599"=>"899","49982"=>"1060","50007"=>"1064","50154"=>"878","50386"=>"1073","51100"=>"1107","51296"=>"950","51272"=>"1038","51970"=>"869","52405"=>"1127","52770"=>"1107","52915"=>"1038","52945"=>"1073","54458"=>"1037","54458"=>"871","52969"=>"1038","52920"=>"1073","55644"=>"1103","56591"=>"1169","57366"=>"1050","57567"=>"1050","57637"=>"1188","57479"=>"933","54989"=>"869","54989"=>"906","52274"=>"1063","57379"=>"869","59016"=>"904","59016"=>"1076","58951"=>"1185","58169"=>"1097","57574"=>"906","59449"=>"1195","59764"=>"1063","59785"=>"933","59616"=>"1159","60246"=>"1203","59995"=>"1201","59995"=>"1189","59995"=>"1202","57295"=>"906","57295"=>"1037","57295"=>"933","57300"=>"906","57300"=>"1037","57300"=>"933","57521"=>"906","57521"=>"1037","57521"=>"933","60457"=>"933","60457"=>"913","60457"=>"909","60457"=>"1152","60627"=>"1050","60651"=>"833","60709"=>"1185","60989"=>"933","61051"=>"1078","61228"=>"869","61637"=>"933","61655"=>"1071","60985"=>"933","62627"=>"909","62627"=>"1152","62627"=>"933","62627"=>"913","63750"=>"1050","54322"=>"1081","64075"=>"897","63979"=>"1233","61444"=>"933","64848"=>"986","64776"=>"1273","65311"=>"1279","65439"=>"1062","65815"=>"1217","66603"=>"1152","66715"=>"1218","66598"=>"1239","66910"=>"1038","66910"=>"1217","66910"=>"904","66907"=>"904","66882"=>"904","67159"=>"1307","67631"=>"1106","67650"=>"1185","67750"=>"1294","65150"=>"1092","67155"=>"1252","67509"=>"1295","67473"=>"1256","67719"=>"1295","66893"=>"1129","67336"=>"1038","67225"=>"1050","66314"=>"1273","66314"=>"1038"];
foreach ($data as $key=>$value) {
    $DBLIB->where("articles_id", $key);
    $article = $DBLIB->getone("articles",["articles_authors"]);

    if (!is_numeric($value)) {
        $DBLIB->where("users_username LIKE '%" . $bCMS->sanitizeString($value) . "%'");
        $author = $DBLIB->getone("users", ["users_userid","users_username"]);
        if (!$author) {
            echo $key . "\n";
            continue;
        }
        $value = $author['users_userid'];


    }
    //$DBLIB->where("articles_id", $key);
    //if (!$DBLIB->update("articles", ["articles_authors"=>$article["articles_authors"] . "," . $value])) echo $key . "\n";
}
*/

$DBLIB->where("articles_thumbnail IS NULL");
foreach ($DBLIB->get("articles",null,["articles_id", "articles_extraMetadata"]) as $article) {
    $article["articles_extraMetadata"] = json_decode($article["articles_extraMetadata"], true);
    if (isset($article["articles_extraMetadata"]["_thumbnail_id"]) and $article["articles_extraMetadata"]["_thumbnail_id"] != null) {
        $DBLIB->where("articles_id",$article['articles_id']);
        $DBLIB->update("articles", ["articles_thumbnail" => $article["articles_extraMetadata"]["_thumbnail_id"]]);
    }
}


$DBLIB->rawQuery("UPDATE articles SET articles_slug = replace(articles_slug, 'http://www.nouse.co.uk/', '');");
foreach ($DBLIB->get("articles", null, ["articles_slug", "articles_id"]) as $article) {
    if (isset(explode("/", $article["articles_slug"])[3])) {
        $DBLIB->where("articles_id",$article['articles_id']);
        $DBLIB->update("articles", ["articles_slug" => explode("/", $article["articles_slug"])[3]]);
    }
}

$articles = $DBLIB->get("articlesDrafts", null, ["articlesDrafts_id"]);
foreach ($articles as $article) {
    $DBLIB->where("articlesDrafts_id", $article["articlesDrafts_id"]);
    $article = $DBLIB->getone("articlesDrafts");
    $article["articlesDrafts_id"] = null;
    $article["articlesDrafts_timestamp"] = date('Y-m-d H:i:s');

    $article["articlesDrafts_text"] = preg_replace('~(\[caption id)(.*)(src="http://www.nouse.co.uk/wp-content/article_images)~', '<figure class="legacyWordpressFigure"><img class="legacyWordpressImageFigure img-responsive" src="[ARCHIVECDNURL]/articleImages', $article["articlesDrafts_text"]);
    $article["articlesDrafts_text"] = preg_replace('~(\<img class=\")(.*)(src="http://www.nouse.co.uk/wp-content/article_images)~', '<img class="legacyWordpressImage img-responsive" src="[ARCHIVECDNURL]/articleImages', $article["articlesDrafts_text"]);
    $article["articlesDrafts_text"] = str_replace('[/caption]', 'CAPEND', $article["articlesDrafts_text"]);
    $article["articlesDrafts_text"] = preg_replace('~(?<=\/>)(.*)(CAPEND)~', '<figcaption>$1</figcaption></figure>', $article["articlesDrafts_text"]);

    $DBLIB->insert("articlesDrafts", $article);
}

?>


